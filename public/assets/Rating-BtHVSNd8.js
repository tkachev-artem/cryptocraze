import{j as e}from"./vendor-query-xVwBccZt.js";import{r as s,b as a}from"./vendor-react-DaALiM5L.js";import{g as t,A as r,h as n}from"./trading-DauNLBUI.js";import{u as i}from"./index-3eMW2xY9.js";import"./vendor-redux-Bn24jW_n.js";import"./vendor-charts-ioXX35je.js";import"./vendor-socket-CUkmNz_4.js";const l=e=>n(e),c=e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-gray-200 animate-pulse"}),e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-200 animate-pulse"}),e.jsx("div",{className:"h-3 w-28 rounded bg-gray-200 animate-pulse"})]}),e.jsx("div",{className:"h-3 w-20 rounded bg-gray-200 animate-pulse"})]}),d=({leader:s})=>{const{t:a}=t(),r=s.rank<=3,n=!!s.isPremium,i=s.pnlUsd<0;return e.jsxs("div",{className:`relative bg-white rounded-xl ${n?"border border-transparent ring-inset ring-2 ring-[#F5A600]":"border border-gray-200"} overflow-hidden`,children:[n&&e.jsx("div",{className:"absolute top-0 left-0 z-10",children:e.jsx("div",{className:"flex items-center gap-1 bg-[#F5A600] text-black px-1 py-1 rounded-full",children:e.jsx("img",{src:"/crown.png",alt:a("rating.premium"),className:"w-5 h-5"})})}),r&&e.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 flex min-w-[121px] h-full p-0 items-center gap-[12px] rounded-none",style:{backgroundImage:"url(/rating/top-bg.png)",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsxs("div",{className:"flex w-full items-center justify-end gap-2 px-3",children:[e.jsxs("span",{className:"text-[12px] font-extrabold text-[#F5A600]",children:[i?"-":"",l(Math.abs(s.pnlUsd))]}),e.jsx("img",{src:i?"/rating/arrow-down.svg":"/rating/arrow-up.svg",alt:a(i?"trading.loss":"trading.gain"),className:"w-3 h-3"}),e.jsx("div",{className:"min-w-[28px] h-6 px-2 rounded-full bg-[#F5A600] text-black flex items-center justify-center text-xs font-bold flex-shrink-0",children:s.rank})]})}),e.jsxs("div",{className:"flex items-center justify-between p-3 "+(r?"pr-[132px]":""),children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("img",{src:s.avatarUrl??"/avatar.png",alt:s.username,className:"w-12 h-12 rounded-full",onError:e=>{e.currentTarget.src="/avatar.png"}}),e.jsx("div",{className:"flex flex-col min-w-0",children:e.jsx("span",{className:"text-sm font-bold text-black truncate max-w-[160px]",children:s.username})})]}),!r&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-extrabold text-[#0C46BE]",children:[i?"-":"",l(Math.abs(s.pnlUsd))]}),e.jsx("img",{src:i?"/rating/arrow-down.svg":"/rating/arrow-up.svg",alt:a(i?"trading.loss":"trading.gain"),className:"w-3 h-3"}),e.jsx("div",{className:"min-w-[28px] h-6 px-2 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0 bg-[#F1F7FF] text-black",children:s.rank})]})]})]})},o=()=>{const[n]=s.useState("month"),[l,o]=s.useState(null),[m,x]=s.useState(!1),[u,g]=s.useState(null),[p,f]=s.useState(!1),h=a(),{t:j}=t(),{user:b,isAuthenticated:v}=i();return s.useEffect(()=>{(async()=>{x(!0);try{const e=new URLSearchParams({period:n,offset:String(0),limit:String(50)}),s=await fetch(`${r}/rating?${e.toString()}`,{credentials:"include"}),a=await s.json();o(a)}catch(e){o([])}finally{x(!1)}})()},[n]),s.useEffect(()=>{if(!v||!b)return void g(null);if(l&&l.length>0){const e=l.find(e=>e.userId===b.id)??null;if(e)return void g(e)}let e=!1;return(async()=>{f(!0);try{const s=await fetch(`${r}/user/stats`,{credentials:"include"});if(!s.ok)return;const a=await s.json(),t="number"==typeof a.ratingRank30Days?a.ratingRank30Days:null;if(!t||t<1){const s=b.firstName?`${b.firstName}${b.lastName?" "+b.lastName:""}`:b.email||b.id,a={userId:b.id,username:s,avatarUrl:b.profileImageUrl,pnlUsd:0,winRate:0,trades:0,rank:0,isPremium:Boolean(b.isPremium)};return void(e||g(a))}const i=new URLSearchParams({period:n,offset:String(Math.max(0,t-1)),limit:"1"}),l=await fetch(`${r}/rating?${i.toString()}`,{credentials:"include"});if(!l.ok)return;const c=await l.json();e||g(c[0]??null)}catch(s){}finally{e||f(!1)}})(),()=>{e=!0}},[v,b,l,n]),e.jsxs("div",{className:"min-h-screen bg-white flex flex-col pb-[calc(56px+env(safe-area-inset-bottom))]",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-4",children:[e.jsxs("button",{onClick:()=>{h(-1)},className:"flex items-center gap-2",children:[e.jsx("img",{src:"/top-menu/back.svg",alt:j("nav.back"),className:"w-6 h-6"}),e.jsx("span",{className:"text-xl font-extrabold text-black",children:j("nav.back")})]}),e.jsx("div",{className:"w-6 h-6"})]}),e.jsx("div",{className:"px-4 pb-4",children:e.jsx("div",{className:"flex w-full h-[50px] p-[16px] justify-center items-center gap-[10px] flex-shrink-0 rounded-[16px] mx-auto",style:{backgroundImage:"url(/rating/rating-bg.png)",backgroundSize:"cover",backgroundPosition:"center"},children:e.jsx("span",{className:"text-[#FFF] text-center text-[16px] font-bold tracking-[0px]",children:j("rating.last30d")})})})]}),e.jsxs("div",{className:"flex-1 px-4 space-y-3 pb-36",children:[(m||!l)&&e.jsxs("div",{className:"space-y-3",children:[c,c,c,c,c]}),!m&&l&&0===l.length&&e.jsx("div",{className:"py-8 text-center text-sm text-black opacity-50",children:j("common.noData")}),!m&&l&&l.length>0&&e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsx(d,{leader:s},s.userId))})]}),!m&&(null!=u||p)&&e.jsx("div",{className:"fixed left-0 right-0 bottom-0 z-10 bg-[#F1F7FF]",children:e.jsx("div",{className:"px-4 pt-3 pb-[calc(env(safe-area-inset-bottom)+12px)]",children:u?e.jsx(d,{leader:u}):e.jsx("div",{className:"relative bg-white rounded-xl border border-gray-200 overflow-hidden",children:e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 animate-pulse"}),e.jsx("div",{className:"flex flex-col min-w-0",children:e.jsx("div",{className:"h-3 w-28 rounded bg-gray-200 animate-pulse"})})]}),e.jsx("div",{className:"h-3 w-20 rounded bg-gray-200 animate-pulse"})]})})})})]})};export{o as default};
