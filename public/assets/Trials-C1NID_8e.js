import{j as e}from"./vendor-query-xVwBccZt.js";import{r as s,g as t,b as a}from"./vendor-react-DaALiM5L.js";import{u as r,f as l,g as n,Q as o,A as i,G as c,h as d}from"./trading-DauNLBUI.js";import{u as x}from"./index-3eMW2xY9.js";import"./vendor-redux-Bn24jW_n.js";import"./vendor-charts-ioXX35je.js";import"./vendor-socket-CUkmNz_4.js";const u="/api";var m;(e=>{const s=`${u}/tasks`;e.getTasks=async function(){try{const e=await fetch(s,{method:"GET",credentials:"include"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status.toString()}`);return(await e.json()).tasks}catch(e){throw e}},e.completeTask=async function(e){try{const t=await fetch(`${s}/${e}/complete`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const e=await t.json().catch(()=>({error:"Unknown error"}));throw new Error(e.error??`HTTP error! status: ${t.status.toString()}`)}return await t.json()}catch(t){throw t}},e.replaceTask=async function(e){try{const t=await fetch(`${s}/${e}/replace`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!t.ok){const e=await t.json().catch(()=>({error:"Unknown error"}));throw new Error(e.error??`HTTP error! status: ${t.status.toString()}`)}return await t.json()}catch(t){throw t}},e.updateTaskProgress=async function(e,t){try{const a=await fetch(`${s}/${e}/progress`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({progress:t}),credentials:"include"});if(!a.ok){const e=await a.json().catch(()=>({error:"Unknown error"}));throw new Error(e.error??`HTTP error! status: ${a.status.toString()}`)}return await a.json()}catch(a){throw a}},e.getWheelPrizes=async function(){try{const e=await fetch(`${u}/wheel/prizes`,{method:"GET",credentials:"include"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status.toString()}`);return(await e.json()).prizes}catch(e){throw e}},e.spinWheel=async function(){try{const e=await fetch(`${u}/wheel/spin`,{method:"POST",credentials:"include"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status.toString()}`);return await e.json()}catch(e){throw e}}})(m||(m={}));const p="cryptocraze_tasks",h="cryptocraze_task_completions",f="cryptocraze_task_cooldowns",g=e=>{try{const s={tasks:e,lastUpdated:Date.now(),completions:y(),cooldowns:w()};localStorage.setItem(p,JSON.stringify(s))}catch(s){}},b=()=>{try{const e=localStorage.getItem(p);if(!e)return null;const s=JSON.parse(e);if(!s.tasks||!Array.isArray(s.tasks))return null;const t=3e5;return Date.now()-s.lastUpdated>t?null:s}catch(e){return null}},y=()=>{try{const e=localStorage.getItem(h);if(!e)return[];const s=JSON.parse(e),t=Date.now();return s.filter(e=>!e.expiresAt||e.expiresAt>t)}catch(e){return[]}},w=()=>{try{const e=localStorage.getItem(f);if(!e)return[];const s=JSON.parse(e),t=Date.now();return s.filter(e=>e.cooldownUntil>t)}catch(e){return[]}},j=()=>{try{y(),w()}catch(e){}};function v(){const[e,t]=s.useState([]),[a,n]=s.useState(!0),[o,i]=s.useState(null),[c,d]=s.useState(null),x=r(),u=s.useCallback(async()=>{try{i(null);const e=b();(null==e?void 0:e.tasks)&&!a&&(t(e.tasks),n(!1));const s=(await m.getTasks()).filter(e=>{return s=e.taskType,!w().some(e=>e.taskType===s);var s});t(s),g(s)}catch(e){const s=e instanceof Error?e.message:"Failed to load tasks";i(s);const a=b();(null==a?void 0:a.tasks)?t(a.tasks):t([])}finally{n(!1)}},[]),p=s.useCallback(async e=>{try{i(null);const s=await m.completeTask(e);if(!s.success)throw new Error(s.error??"Failed to complete task");if(t(t=>{const a=t.filter(s=>s.id!==e);return s.newTask&&a.push(s.newTask),g(a),a}),s.completedTask){const t=s.completedTask.expiresAt?new Date(s.completedTask.expiresAt).getTime():void 0;((e,s)=>{try{const t=y(),a={taskId:e,completedAt:Date.now(),expiresAt:s},r=t.filter(s=>s.taskId!==e);r.push(a);const l=Date.now(),n=r.filter(e=>!e.expiresAt||e.expiresAt>l);localStorage.setItem(h,JSON.stringify(n))}catch(o){}})(e,t),((e,s)=>{try{const t=w(),a=Date.now()+60*s*1e3,r={taskType:e,cooldownUntil:a},l=t.filter(s=>s.taskType!==e);l.push(r);const n=Date.now(),o=l.filter(e=>e.cooldownUntil>n);localStorage.setItem(f,JSON.stringify(o))}catch(o){}})(s.completedTask.taskType,30)}x(l()),s.completedTask&&d({message:`Task completed! Received: ${String(s.completedTask.reward.amount)} ${s.completedTask.reward.type}`,type:"success"})}catch(s){const e=s instanceof Error?s.message:"Failed to complete task";i(e),d({message:e,type:"error"})}},[x]),v=s.useCallback(async(e,s)=>{try{i(null);const a=await m.updateTaskProgress(e,s);t(s=>s.map(s=>s.id===e?{...a.task,isCompleted:a.isCompleted,rewardClaimed:a.rewardClaimed}:s))}catch(a){const e=a instanceof Error?a.message:"Failed to update task progress";e.includes("Задание не найдено")||e.includes("Task not found")||(i(e),d({message:e,type:"error"}))}},[]),k=s.useCallback(async e=>{try{i(null);const s=await m.replaceTask(e);if(!s.success)throw new Error(s.error??"Failed to replace task");return t(t=>{const a=t.filter(s=>s.id!==e);return s.newTask&&a.push(s.newTask),a}),d({message:"Task replaced successfully",type:"success"}),!0}catch(s){const e=s instanceof Error?s.message:"Failed to replace task";return i(e),d({message:e,type:"error"}),!1}},[]),N=s.useCallback(()=>{u()},[u]),T=s.useCallback(()=>{d(null)},[]),C=s.useCallback(()=>{i(null)},[]);return s.useEffect(()=>{j(),u()},[u]),s.useEffect(()=>{const e=setInterval(()=>{j(),u()},6e4);return()=>{clearInterval(e)}},[u]),s.useEffect(()=>{if(c){const e=setTimeout(()=>{d(null)},5e3);return()=>{clearTimeout(e)}}},[c]),{tasks:e,isLoading:a,error:o,notification:c,completeTask:p,updateTaskProgress:v,replaceTask:k,refreshTasks:N,clearNotification:T,clearError:C,handleUpdateProgress:v,handleReplaceTask:k,handleClaimReward:p}}const k=({isOpen:t,onClose:a,onSpin:r})=>{const{t:l}=n(),[o,i]=s.useState(!1),[c,d]=s.useState(0),[x,u]=s.useState(null),m=s.useRef(null),p=s.useCallback(async()=>{if(!o)try{i(!0),u(null);const e=await r(),s=Math.max(0,Math.min(e.index,8)),t=c+(1800+(360-(40*s+20)));d(t),m.current&&(m.current.style.transition="transform 3s cubic-bezier(0.23, 1, 0.320, 1)",m.current.style.transform=`rotate(${String(t)}deg)`),setTimeout(()=>{u(e.prize),i(!1)},3500)}catch(e){i(!1)}},[o,c,r]),h=s.useCallback(()=>{o||(u(null),d(0),m.current&&(m.current.style.transition="none",m.current.style.transform="rotate(0deg)"),a())},[o,a]);return t?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",style:{background:"radial-gradient(circle at 50% 44.25%, #0C54EA 14.52%, #072F84 100%)"},children:e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-between p-6",children:[e.jsx("div",{className:"text-center pt-8",children:e.jsx("h2",{className:"text-white text-2xl font-bold",children:l(null===x||o?"wheel.tryLuck":"wheel.yourWin")})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:null===x||o?e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("img",{src:"/wheel/bear.svg",alt:"bear",className:"w-32 h-40"}),e.jsxs("div",{className:"relative",style:{width:"320px",height:"320px"},children:[e.jsx("img",{src:"/wheel/arrow.svg",alt:"arrow",className:"absolute z-10 pointer-events-none select-none",style:{left:"50%",top:"38%",transform:"translate(-50%, -50%)",width:"23px",height:"62px"}}),e.jsx("div",{ref:m,className:"absolute inset-0 will-change-transform",style:{transform:`rotate(${String(c)}deg)`,transformOrigin:"50% 50%"},children:e.jsx("img",{src:"/wheel/background.svg",alt:"wheel",className:"w-full h-full select-none",draggable:!1})}),e.jsx("img",{src:"/wheel/circle.svg",alt:"center",className:"absolute z-20 pointer-events-none select-none",style:{left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"32px",height:"32px"}})]})]}):e.jsxs("div",{className:"text-center flex flex-col items-center gap-4",children:[e.jsx("img",{src:"/wheel/coins.svg",alt:"coins",className:"w-32 h-24"}),e.jsxs("p",{className:"text-[40px] font-extrabold tracking-[0px] text-[#F5A600]",children:["$",String(x)]})]})}),e.jsx("div",{className:"text-center pb-8 w-full max-w-md",children:x?e.jsx("button",{onClick:h,className:"flex w-full h-[48px] px-[16px] flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-[#0C54EA] text-white font-bold transition-colors hover:bg-[#0A4BD8]",children:l("common.claim")}):e.jsx("button",{onClick:()=>{p()},disabled:o,className:"flex w-full h-[48px] px-[16px] flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-white text-blue-600 font-bold transition-colors hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed",children:l(o?"wheel.spinning":"wheel.spin")})})]})}):null},N=t.memo(({task:t,onComplete:a,onUpdateProgress:r,onReplace:l,onWheelOpen:i})=>{const{t:c}=n(),{translateTask:d}=o(),[x,u]=s.useState(!1),[m,p]=s.useState(!1),[h,f]=s.useState(!1),[g,b]=s.useState(!0),[y,w]=s.useState(!1),j=s.useMemo(()=>{if(!t.progress.total||0===t.progress.total)return 0;return t.progress.current/t.progress.total*100},[t.progress,t.title,t.id]),v=s.useMemo(()=>"active"===t.status,[t.status]),k=s.useMemo(()=>"completed"===t.status,[t.status]),N=s.useMemo(()=>t.progress.current>=t.progress.total&&t.progress.total>0,[t.progress]),T=s.useMemo(()=>!0===t.isCompleted&&!1===t.rewardClaimed,[t.isCompleted,t.rewardClaimed]);s.useEffect(()=>{if(g){const e=setTimeout(()=>{b(!1)},400);return()=>{clearTimeout(e)}}},[g]),s.useEffect(()=>{!v&&y&&w(!1)},[v,y,t.title]);const C=s.useMemo(()=>d(t),[t,d]),S=s.useMemo(()=>C.title===c("task.dailyBonus"),[C.title,c]),E=s.useMemo(()=>C.title===c("task.videoBonus"),[C.title,c]),$=s.useMemo(()=>C.title===c("task.videoBonus2"),[C.title,c]),A=s.useMemo(()=>C.title===c("task.dealOfDay"),[C.title,c]),F=s.useMemo(()=>(E||$)&&v&&(N||T),[E,$,v,N,T]),P=s.useCallback(e=>{switch(e){case"money":return"/trials/dollars.svg";case"coins":return"/money.svg";case"energy":case"mixed":return"/trials/energy.svg";case"wheel":return"/trials/wheel.svg";default:return"/trials/energy-white.svg"}},[]),B=s.useMemo(()=>t.reward,[t.reward]),I=s.useCallback(async()=>{if(!x&&v)if("wheel"!==t.reward.type){u(!0),p(!0);try{await a(t.id),setTimeout(()=>{f(!0)},1e3)}catch(e){}finally{u(!1),setTimeout(()=>{p(!1)},500)}}else null==i||i(t.id)},[x,v,t.id,t.title,t.reward,a,i]),O=s.useCallback(async()=>{if(!x&&v&&r&&!N&&!T){w(!0),u(!0);try{await new Promise(e=>setTimeout(e,3e3));const e=Math.min((t.progress.current||0)+1,t.progress.total||1);await r(t.id,e)}catch(e){}finally{w(!1),u(!1)}}},[x,v,r,t.id,t.progress,t.title,N,T]),z=I,M=s.useCallback(async()=>{if(!x&&l){u(!0);try{await l(t.id)?setTimeout(()=>{f(!0)},100):(p(!0),setTimeout(()=>{p(!1)},350))}catch(e){}finally{u(!1)}}},[x,t.id,t.title,l]),D=s.useMemo(()=>`task-card bg-white rounded-xl border border-gray-200 transition-all duration-300 relative transform hover:scale-105 ${m?"scale-105":""} ${h?"slideOut":""} ${g?"slideInFromBottom":""}`.trim(),[m,h,g]),R=s.useMemo(()=>"h-4 rounded-full transition-all duration-500 ease-out bg-[#0C54EA]",[]);return e.jsx("div",{className:`${D} overflow-hidden`,children:e.jsxs("div",{className:"flex items-stretch min-h-[100px]",children:[e.jsx("div",{className:"w-20 bg-[#F1F7FF] border-r border-gray-200 rounded-l-xl flex flex-col items-center justify-center gap-2 p-3",children:e.jsx("div",{className:"flex flex-col items-center gap-2",children:"mixed"===B.type&&B.amount.includes("_energy_")?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"w-6 h-6 bg-[#0C54EA] rounded-full flex items-center justify-center",children:e.jsx("img",{src:"/trials/energy.svg",alt:"energy",className:"w-4 h-4 filter brightness-0 invert"})}),e.jsx("span",{className:"text-sm font-bold text-black",children:B.amount.split("_")[0]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[B.amount.includes("_money")?e.jsx("img",{src:"/trials/dollars.svg",alt:"money",className:"w-6 h-6"}):e.jsx("img",{src:"/money.svg",alt:"coins",className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-bold text-black",children:(()=>{const e=B.amount.split("_energy_")[1];if(!e)return"0";return e.split("_")[0]||"0"})()})]})]}):"wheel"===B.type?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:P(B.type),alt:B.type,className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-bold text-black whitespace-nowrap",children:"1"})]}):e.jsxs(e.Fragment,{children:["energy"===B.type?e.jsx("div",{className:"w-6 h-6 bg-[#0C54EA] rounded-full flex items-center justify-center",children:e.jsx("img",{src:P(B.type),alt:B.type,className:"w-4 h-4 filter brightness-0 invert"})}):e.jsx("img",{src:P(B.type),alt:B.type,className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-bold text-black",children:B.amount})]})})}),e.jsxs("div",{className:"flex-1 p-3 flex flex-col justify-between "+(N||k||T||S&&v||F?"bg-[#0C54EA26]":""),children:[e.jsxs("div",{className:"space-y-1 text-start mb-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"font-bold text-base text-black",children:C.title})}),e.jsx("p",{className:"text-xs font-semibold text-black opacity-80",children:C.description})]}),!v||S||E||$||N?S&&v&&!N&&!k?e.jsx("div",{className:"flex justify-start mt-4",children:e.jsx("button",{onClick:()=>{I()},disabled:x,className:"flex w-[120px] h-[28px] p-0 flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-[#0C54EA] text-white font-bold text-base hover:bg-[#0A4BC8] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin mr-1"}),e.jsx("span",{className:"text-xs",children:"..."})]}):c("common.claim")})}):(E||$)&&v&&!N?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-xs font-bold text-[#0C54EA]",children:[t.progress.current||0,"/",t.progress.total||1]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:R,role:"progressbar","aria-label":c("task.progressLabel"),"aria-valuenow":Number(j.toFixed(0)),"aria-valuemin":0,"aria-valuemax":100,style:{width:`${j.toString()}%`,transition:"width 0.5s ease-out"}})}),e.jsx("div",{className:"flex mt-2",children:e.jsx("button",{onClick:()=>{O()},disabled:x||y,className:"flex w-[120px] h-[28px] p-0 flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-[#0C54EA] text-white font-bold text-base hover:bg-[#0A4BC8] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x||y?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin mr-1"}),e.jsx("span",{className:"text-xs",children:y?"Ad...":"..."})]}):c("common.execute")})})]}):F?e.jsx("div",{className:"flex justify-start mt-4",children:e.jsx("button",{onClick:()=>{$?null==i||i(t.id):z()},disabled:x,className:"flex w-[120px] h-[28px] p-0 flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-[#0C54EA] text-white font-bold text-base hover:bg-[#0A4BC8] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin mr-1"}),e.jsx("span",{className:"text-xs",children:"..."})]}):c($?"wheel.spin":"common.claim")})}):v&&(N||k)||(S||A)&&(k||N)?e.jsx("div",{className:"flex justify-start mt-4",children:e.jsx("button",{onClick:()=>{I()},disabled:x,className:"flex w-[120px] h-[28px] p-0 flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-[#0C54EA] text-white font-bold text-base hover:bg-[#0A4BC8] transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin mr-1"}),e.jsx("span",{className:"text-xs",children:"..."})]}):c("common.claim")})}):null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs("span",{className:"text-xs font-bold text-[#0C54EA]",children:[t.progress.current||0,"/",t.progress.total||1]})}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:e.jsx("div",{className:R,role:"progressbar","aria-label":c("task.progressLabel"),"aria-valuenow":Number(j.toFixed(0)),"aria-valuemin":0,"aria-valuemax":100,style:{width:`${j.toString()}%`,transition:"width 0.5s ease-out"}})})]})]}),e.jsx("div",{className:"absolute top-3 right-3",children:(S||A||E)&&(k||N)?e.jsx("button",{onClick:()=>{M()},disabled:x||!l,className:"w-[32px] h-[32px] bg-white rounded-full flex items-center justify-center hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("img",{src:"/trials/reload.svg",alt:"reload",className:"w-[20px] h-[20px]"})}):e.jsx("button",{onClick:()=>{M()},disabled:x||!l,className:"hover:bg-gray-50 rounded-full p-1 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx("img",{src:"/trials/reload.svg",alt:"reload",className:"w-[20px] h-[20px]"})})})]})})}),T=({type:t,isOpen:a,onClose:o})=>{const{t:c}=n(),d=r(),[x,u]=s.useState(!1),[m,p]=s.useState(null),h=Boolean(m);if(!a&&!h)return null;const f={red:{closeImage:"/boxes/red-box/close/box.svg",openImage:"/boxes/red-box/open/open-box.svg",title:c("box.red.title")},green:{closeImage:"/boxes/green-box/close/box.svg",openImage:"/boxes/green-box/open/open-box.svg",title:c("box.green.title")},x:{closeImage:"/boxes/x-box/close/box.svg",openImage:"/boxes/x-box/open/open-box.svg",title:c("box.x.title")}}[t];if(h&&m){const s="pro"===m.type?c("box.proPrize",{days:String(m.days??3)}):`$${String(m.amount??0)}`;return e.jsx("div",{className:"fixed inset-0 z-50",children:e.jsxs("div",{className:"w-full h-full relative p-4",style:{background:"radial-gradient(197.89% 49.47% at 50% 50%, #422982 0%, #25094F 100%), #FFF"},children:[e.jsxs("div",{className:"absolute top-[80px] left-1/2 transform -translate-x-1/2 text-center",children:[e.jsx("h2",{className:"text-white text-[29px] font-bold mb-4",children:c("box.yourPrize")}),e.jsx("p",{className:"text-[#F5A600] text-[40px] font-extrabold",children:s})]}),e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center",children:e.jsx("img",{src:f.openImage,alt:"Opened Box",className:"w-52 h-60"})}),e.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 w-full px-4",children:e.jsx("button",{onClick:()=>{(async()=>{p(null),o(),await d(l())})()},className:"flex w-full h-[48px] px-[16px] flex-col justify-center items-center gap-[8px] flex-shrink-0 rounded-[100px] bg-[#0C54EA] text-white font-bold transition-colors hover:bg-[#0A4BD8]",children:c("common.claim")})})]})})}return a?e.jsx("div",{className:"fixed inset-0 z-50",children:e.jsx("div",{className:"w-full h-full flex flex-col items-center justify-center p-4",style:{background:"radial-gradient(197.89% 49.47% at 50% 50%, #422982 0%, #25094F 100%), #FFF"},children:e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[e.jsx("div",{className:"cursor-pointer transition-transform "+(x?"shake-animation":"hover:scale-105"),onClick:x?void 0:()=>{(async()=>{if(!x)try{u(!0),await new Promise(e=>setTimeout(e,1500));const e=`${i}/${String(t)}-box/open`,s=await fetch(e,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!s.ok){const e=await s.json().catch(()=>({}));throw new Error(e.error??c("box.openError"))}const a=await s.json();p({...a.prize,energySpent:a.energySpent}),await d(l())}catch(e){alert(e instanceof Error?e.message:c("box.openError"))}finally{u(!1)}})()},children:e.jsx("img",{src:f.closeImage,alt:`${t} box`,className:"w-52 h-60 mb-6"})}),!x&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-white text-3xl font-bold mb-4",children:f.title}),e.jsx("p",{className:"text-white text-lg opacity-80 text-center",children:c("box.tapInstruction")})]})]})})}):null},C=({energyProgress:s,onRedBoxClick:t,onGreenBoxClick:a,onXBoxClick:r})=>{const{t:l}=n(),o=Math.min(s,100),i=[{position:0,icon:"/trials/energy.svg",label:`${String(s)}/100`,isEnergy:!0},{position:30,icon:"/trials/red-box.svg",label:"30",isRedBox:!0},{position:70,icon:"/trials/green-box.svg",label:"70",isGreenBox:!0},{position:100,icon:"/trials/x-box.svg",label:"100",isXBox:!0}];return e.jsx("div",{className:"w-full py-4",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-[20px] overflow-hidden relative",children:e.jsx("div",{className:"bg-[#0C54EA] h-full rounded-full transition-all duration-700 ease-out",style:{width:`${String(o)}%`}})}),e.jsx("div",{className:"pointer-events-none absolute left-0 top-1/2 -translate-y-1/2 h-[20px] w-[20px] bg-white rounded-l-full z-[5]"}),i.map(n=>{const o=s>=n.position,i=n.isRedBox&&o,c=n.isGreenBox&&o,d=n.isXBox&&o,x=!!i||(!!c||d),u=0===n.position?"0%":100===n.position?"-100%":"-50%";return e.jsx("div",{className:"absolute transition-all duration-700 ease-out "+(o?"z-10":"z-0"),style:{left:`${String(n.position)}%`,top:"50%",transform:`translate(${u}, -50%)`},children:e.jsxs("div",{className:"flex flex-col items-center gap-1 mt-4",children:[e.jsxs("div",{className:`${n.isEnergy?"w-[40px] h-[40px]":"w-[60px] h-[60px]"} relative group ${x?"cursor-pointer":""}`,onClick:x?()=>{i&&t(),c&&a(),d&&r()}:void 0,children:[e.jsx("div",{className:`w-full h-full ${n.isEnergy?"rounded-full":"rounded-[50px]"} border-[2px] transition-all duration-500 ${n.isEnergy||o?"bg-[#F1F7FF] border-[#0C54EA]":"bg-gray-100 border-gray-300"}`,children:e.jsx("img",{src:n.icon,alt:n.isEnergy?"energy":"reward box",className:`w-full h-full object-contain ${n.isEnergy,"p-2"} transition-all duration-500 relative z-10`})}),o&&!n.isEnergy&&e.jsx("div",{className:"absolute inset-0 bg-[#0C54EA] rounded-full opacity-10 animate-pulse z-0",style:{animationDuration:"10s"}}),e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap",children:l(x?"ui.trials.clickToOpen":"ui.trials.rewardReceived")})]}),e.jsx("span",{className:"text-sm font-bold transition-all duration-500 "+(n.isEnergy||o?"text-[#0C54EA]":"text-gray-400"),children:n.label})]})},n.position)})]})})})};function S(){const t=a(),{t:o}=n(),{user:i}=x(),u=r(),{tasks:p,isLoading:h,completeTask:f,updateTaskProgress:g,replaceTask:b}=v(),[y,w]=s.useState(!1),[j,S]=s.useState(!1),[E,$]=s.useState(!1),[A,F]=s.useState(!1),[P,B]=s.useState(0),[I]=s.useState(new Set),[O,z]=s.useState(null),M=s.useRef(!1),D=e=>{z(e),F(!0)};s.useEffect(()=>{if(!P)return;const e=setInterval(()=>{Date.now()>=P&&(u({type:"user/clearEnergyOverride"}),B(0),clearInterval(e))},250);return()=>{clearInterval(e)}},[P,u]);const R=s.useMemo(()=>({balance:null==i?void 0:i.balance,coins:null==i?void 0:i.coins,energyProgress:(null==i?void 0:i.energyTasksBonus)??0,userId:null==i?void 0:i.id}),[null==i?void 0:i.balance,null==i?void 0:i.coins,null==i?void 0:i.energyTasksBonus,null==i?void 0:i.id]),_=s.useMemo(()=>p.filter(e=>"completed"!==e.status&&!I.has(e.id)),[p,I]),U=s.useMemo(()=>({balance:R.balance,coins:R.coins,energyProgress:R.energyProgress}),[R.balance,R.coins,R.energyProgress]);return s.useEffect(()=>{M.current||(u(l()),M.current=!0);const e=setInterval(()=>{u(l())},1e4);return()=>{clearInterval(e)}},[u]),e.jsx(c,{className:"p-0",children:e.jsxs("div",{className:"flex flex-col min-h-screen bg-white pb-[calc(16px+env(safe-area-inset-bottom))]",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white flex items-center justify-between px-4 py-4",children:[e.jsxs("button",{onClick:()=>{t(-1)},className:"flex items-center gap-2",children:[e.jsx("img",{src:"/top-menu/back.svg",alt:o("nav.back"),className:"w-6 h-6"}),e.jsx("span",{className:"text-xl font-extrabold text-black",children:o("nav.back")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:"/trials/dollars.svg",alt:o("alt.balance"),className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-bold text-black",children:(G=U.balance??0,d(G))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:"/money.svg",alt:o("alt.coins"),className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-bold text-black",children:U.coins??500})]})]})]}),e.jsx("div",{className:"px-4 py-4 pb-8",children:e.jsx(C,{energyProgress:U.energyProgress,onRedBoxClick:()=>{w(!0)},onGreenBoxClick:()=>{S(!0)},onXBoxClick:()=>{$(!0)}})}),e.jsx(T,{type:"red",isOpen:y,onClose:()=>{w(!1)}}),e.jsx(T,{type:"green",isOpen:j,onClose:()=>{S(!1)}}),e.jsx(T,{type:"x",isOpen:E,onClose:()=>{$(!1)}}),e.jsx(k,{isOpen:A,onClose:()=>{F(!1),z(null)},onSpin:async()=>{try{const e=await m.spinWheel();if(O){const e=p.find(e=>e.id===O);e&&"active"===e.status&&f(e.id)}return{prize:e.prize.value,index:e.prize.index}}catch(e){throw e}}}),e.jsx("div",{className:"flex-1 px-4 py-4 overflow-y-auto allow-pan-y",children:h?e.jsx("div",{className:"flex flex-col gap-2",children:[1,2,3].map(s=>e.jsx("div",{className:"w-full bg-white rounded-xl border border-gray-200 p-4 animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]})]})},s))}):0===_.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx("img",{src:"/trials/energy.svg",alt:o("alt.noTasks"),className:"w-16 h-16 mb-4 opacity-50"}),e.jsx("p",{className:"text-gray-500 text-center",children:o("ui.trials.noTasks")}),e.jsx("p",{className:"text-sm text-gray-400 text-center mt-1",children:o("ui.trials.createNewTasks")})]}):e.jsx("div",{className:"tasks-container flex flex-col gap-4",children:_.map(s=>e.jsx(N,{task:s,onComplete:f,onUpdateProgress:g,onReplace:b,onWheelOpen:D},s.id))})})]})});var G}export{S as Trials};
