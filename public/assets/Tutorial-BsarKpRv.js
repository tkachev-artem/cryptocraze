import{j as e,Q as t,u as s,b as i,c as a}from"./vendor-query-xVwBccZt.js";import{r as n,g as r}from"./vendor-react-DaALiM5L.js";import{g as l,C as c,p as o,q as d,r as u,B as m,A as x,t as h}from"./trading-DauNLBUI.js";import{i as g}from"./authUtils-DzLiRfjz.js";import"./vendor-redux-Bn24jW_n.js";import"./vendor-charts-ioXX35je.js";import"./vendor-socket-CUkmNz_4.js";const p=n.forwardRef(({className:t="",value:s=0,...i},a)=>e.jsx("div",{ref:a,className:`relative h-4 w-full overflow-hidden rounded-full bg-gray-100 ${t}`,...i,children:e.jsx("div",{className:"h-full w-full flex-1 bg-gray-900 transition-all",style:{transform:`translateX(-${(100-(s||0)).toString()}%)`}})}));function j({mode:t="tip",message:s,onClose:i,showRandomTips:a=!1}){const{t:r}=l(),[x,h]=n.useState(""),[g,p]=n.useState(!0),j=n.useMemo(()=>["diversify","patience","research","riskManagement","emotions","smallStart","stopLoss","trends"],[]);n.useEffect(()=>{if(a&&!s){const e=j[Math.floor(Math.random()*j.length)];h(r(`panda.tips.${e}`))}},[a,s,r,j]);return g?e.jsxs(c,{className:`max-w-md ${(()=>{switch(t){case"encouragement":return"bg-green-50 border-green-200";case"warning":return"bg-red-50 border-red-200";default:return"bg-blue-50 border-blue-200"}})()}`,children:[e.jsx(o,{className:"pb-2",children:e.jsxs(d,{className:"text-lg flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:(()=>{switch(t){case"encouragement":return"ðŸ¼âœ¨";case"warning":return"ðŸ¼âš ï¸";default:return"ðŸ¼ðŸ’¡"}})()}),(()=>{switch(t){case"tutorial":return r("panda.hello");case"encouragement":return r("panda.encouragement");case"warning":return r("panda.warning");default:return r("panda.tip")}})()]})}),e.jsxs(u,{children:[e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:s??x}),i&&e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{p(!1),i()},children:r("common.close")})})]})]}):null}p.displayName="Progress",new t({defaultOptions:{queries:{retry:(e,t)=>!(t instanceof Error&&t.message.includes("401"))&&e<3,staleTime:3e5,refetchOnWindowFocus:!1}}});const f=async(e,t)=>{const s=/^https?:\/\//.test(i=e)?i:i.startsWith("/api")?`${x}${i.slice(4)}`:i.startsWith("/")?`${x}${i}`:`${x}/${i}`;var i;const a=await fetch(s,t);if(!a.ok){const e=await a.text().catch(()=>"");throw new Error(`Request failed ${String(a.status)}: ${e||a.statusText}`)}return a.json()};function v(){const{t:t}=l(),{isAuthenticated:v,isLoading:N}=function(){const{data:e,isLoading:t}=s({queryKey:[`${x}/auth/user`],queryFn:()=>f("/api/auth/user"),retry:!1});return{user:e,isLoading:t,isAuthenticated:!!e}}(),{toast:b}=h(),w=i(),[y,$]=n.useState(0),[k,S]=n.useState(!1),T=[{id:"welcome",title:t("tutorial.welcome"),content:t("tutorial.pandaIntro")},{id:"interface",title:t("tutorial.step1.title"),content:t("tutorial.step1.content")},{id:"charts",title:t("tutorial.step2.title"),content:t("tutorial.step2.content")},{id:"trading",title:t("tutorial.step3.title"),content:t("tutorial.step3.content")},{id:"risk",title:t("tutorial.step4.title"),content:t("tutorial.step4.content")},{id:"gamification",title:t("tutorial.step5.title"),content:t("tutorial.step5.content")}],q=a({mutationFn:async()=>f("/api/tutorial/complete",{method:"POST"}),onSuccess:()=>{b({title:t("common.success"),description:t("tutorial.congratulations")}),w.invalidateQueries({queryKey:[`${x}/auth/user`]}),setTimeout(()=>{window.location.href="/"},2e3)},onError:e=>{if(g(e))return b({title:t("auth.unauthorized"),description:t("auth.sessionExpired"),variant:"destructive"}),void setTimeout(()=>{window.location.href=`${x}/login`},500);b({title:t("common.error"),description:e.message,variant:"destructive"})}});r.useEffect(()=>{if(!N&&!v)return b({title:t("auth.unauthorized"),description:t("auth.loginRequired"),variant:"destructive"}),void setTimeout(()=>{window.location.href=`${x}/login`},500)},[v,N,b,t]);if(N)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"text-xl",children:t("common.loading")})});if(!v)return null;const C=T[y],E=(y+1)/T.length*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100",children:[e.jsx("header",{className:"bg-white/80 backdrop-blur-sm border-b",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:"ðŸŽ“"}),e.jsx("h1",{className:"text-xl font-bold",children:t("tutorial.title")})]}),e.jsx(m,{variant:"outline",onClick:()=>{q.mutate()},disabled:q.isPending,children:t("tutorial.skipTutorial")})]})})}),e.jsx("main",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(c,{className:"mb-8",children:e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:t("tutorial.stepProgress",{current:y+1,total:T.length})}),e.jsx("span",{className:"text-sm text-gray-600",children:t("tutorial.percentComplete",{percent:Math.round(E)})})]}),e.jsx(p,{value:E})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(c,{className:"h-full",children:[e.jsx(o,{children:e.jsx(d,{className:"text-2xl",children:C.title})}),e.jsxs(u,{className:"space-y-6",children:[e.jsx("div",{className:"text-lg leading-relaxed",children:C.content}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-8 min-h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-6xl mb-4",children:[0===y&&"ðŸ‘‹",1===y&&"ðŸ–¥ï¸",2===y&&"ðŸ“Š",3===y&&"ðŸ’°",4===y&&"âš ï¸",5===y&&"ðŸŽ®"]}),e.jsx("div",{className:"text-gray-600",children:t("tutorial.interactiveArea")})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t",children:[e.jsx(m,{variant:"outline",onClick:()=>{y>0&&$(y-1)},disabled:0===y,children:t("common.previous")}),y===T.length-1?e.jsx(m,{onClick:()=>{S(!0),q.mutate()},disabled:k||q.isPending,className:"bg-green-600 hover:bg-green-700",children:k||q.isPending?t("common.loading"):t("common.finish")}):e.jsx(m,{onClick:()=>{y<T.length-1&&$(y+1)},children:t("common.next")})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-8",children:[e.jsx(j,{mode:"tutorial",message:0===y?t("tutorial.pandaIntro"):`${t("panda.tip")}: ${C.content.substring(0,100)}...`}),e.jsxs(c,{className:"mt-6",children:[e.jsx(o,{children:e.jsx(d,{className:"text-lg",children:t("tutorial.stepsTitle")||"Tutorial Steps"})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-3",children:T.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg transition-colors "+(s===y?"bg-blue-100 text-blue-900":s<y?"bg-green-100 text-green-900":"text-gray-600"),children:[e.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold "+(s===y?"bg-blue-600 text-white":s<y?"bg-green-600 text-white":"bg-gray-300 text-gray-600"),children:s<y?"âœ“":s+1}),e.jsx("div",{className:"text-sm font-medium",children:t.title})]},t.id))})})]})]})})]})]})})]})}export{v as Tutorial};
